# This template configures Nginx to proxy requests to different ports based on the hostname.
# It dynamically sets the listen port and the proxy_pass directive for the forest or lotus metrics server.

events {
    use                 epoll;
    worker_connections  128;
}

http {
    # Node exporter scrape endpoint
    server {
        listen              {{ node_exporter.public_port }};
        location / {
            auth_basic      "Restricted";
            auth_basic_user_file  /etc/nginx/.htpasswd;
            proxy_pass      http://127.0.0.1:{{ node_exporter.port }};
        }
    }

    # Lotus RPC endpoint
    server {
        listen              {{ lotus.rpc.host_port }};
        location / {
            auth_basic      "Restricted";
            auth_basic_user_file  /etc/nginx/.htpasswd;
            proxy_pass      http://127.0.0.1:{{ lotus.rpc.port }}/debug$request_uri;
        }
    }
}
